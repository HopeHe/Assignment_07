{
    "collab_server" : "",
    "contents" : "---\ntitle: \"MSDS597_Assignment07\"\nauthor: \"Linfeng He\"\ndate: \"11/6/2016\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(choroplethr)\n```\n\n## Maternal Mortality Data by country \n```{r }\nmortality <- read_csv(\"data.csv\")\nmortality$`Maternal mortality ratio (per 100 000 live births)`  <- \n  mortality$`Maternal mortality ratio (per 100 000 live births)` %>%\n  str_replace_all(., \" \", \"\") %>%\n  str_extract_all(., '\\\\[[0-9]+\\\\-[0-9]+\\\\]')\n  \nmortality$'Maternal mortality ratio lower_bound' <- \n  str_extract(mortality$`Maternal mortality ratio (per 100 000 live births)`, '[0-9]+') %>%\n  as.numeric()\n\nmortality$'Maternal mortality ratio upper_bound' <- \n    str_extract(mortality$`Maternal mortality ratio (per 100 000 live births)`, '\\\\-[0-9]+') %>%\n    str_replace(., \"-\",\"\") %>%\n    as.numeric()\n\nmortality$Year <-\n    mortality$Year %>%\n    str_replace_all(., '[0-9]+-',\"\") %>%\n    as.numeric()\n```\n\n## The Gross National Income data \n```{r}\ngni <- read_csv(\"GNI per capita.csv\")\ncolnames(gni) <- gni[1,]\ngni <- subset(gni[2:184,])\ngni <- gather(gni, `2013`:`1990`, key = \"year\", value = \"Gross national income per capital\") \ngni$year <- as.numeric(gni$year)\n\ngni$`Gross national income per capital` <-\n    gni$`Gross national income per capital` %>%\n    str_replace_all(., \" \", \"\") %>%\n    as.numeric()\n```\n\n### Merge the two files by country and year, retaining only rows for which you have per capita income *and* either maternal mortality *or* percentage attended births\n```{r}\nCountries <- inner_join(gni, mortality, c(\"Country\"=\"Country\",\"year\" = \"Year\")) %>%\n    filter(., !is.na(`Gross national income per capital`))\n```\n\n### Make a two polished  and informative graphs, one relating income to maternal mortality and the other relating income to percentage attended births\n```{r}\nggplot(data = subset(Countries, year == \"1990\"), aes(`Gross national income per capital`)) +\n  geom_point(alpha = 0.5, aes(y = `Maternal mortality ratio lower_bound`), colour = \"blue\") + \n  geom_point(alpha = 0.5, aes(y= `Maternal mortality ratio upper_bound` ), colour = \"red\")\n\nggplot(data = subset(Countries, year == \"2000\"), aes(`Gross national income per capital`)) +\n  geom_point(alpha = 0.5, aes(y = `Maternal mortality ratio lower_bound`), colour = \"blue\") +\n  geom_point(alpha = 0.5, aes(y= `Maternal mortality ratio upper_bound` ), colour = \"green\")\n\nggplot(Countries) + geom_point(aes(x = `Gross national income per capital`, y = `Births attended by skilled health personnel (%)`)) + facet_wrap(~year)\n```\n\n### Save a csv file with the merged, cleaned, and tidy data, using a suitable name of your choosing in the data folder.\n```{r}\nCountries$`Maternal mortality ratio (per 100 000 live births)` <-\n    as.character(Countries$`Maternal mortality ratio (per 100 000 live births)`)\nwrite_csv(Countries, path = \"mortalityandincome.csv\")\n```\n### Use the country_choropleth() function in the choroplethr package to make a world map of maternal mortality, using the most recent year for each country in the merged dataset you created. The defaults of the function will be fine; no need to tune up the plot. You can read the help file to see how the data must be formatted; you may need to rename the countries from the dataset that you've created.\n```{r}\nCountries.2013 <- filter(Countries, year == \"2013\")\nCountries.2013 <- as.data.frame(Countries.2013)\nCountries.2013$Country <- tolower(Countries.2013$Country)\n\nCountries.2013 %>%\n  dplyr::rename(value = `Births attended by skilled health personnel (%)`) %>%\n  dplyr::rename(region = Country) %>%\n  country_choropleth(num_colors = 9)\n```\n",
    "created" : 1478505412661.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2716538894",
    "id" : "36802D3B",
    "lastKnownWriteTime" : 1478505952,
    "last_content_update" : 1478505952711,
    "path" : "~/Assignment_07/Linfeng.He.Assignment07.Rmd",
    "project_path" : "Linfeng.He.Assignment07.Rmd",
    "properties" : {
        "last_setup_crc32" : "D349849b082371d",
        "tempName" : "Untitled1"
    },
    "relative_order" : 11,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}